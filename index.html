<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TG Mini App — Debug</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body {
      margin: 0;
      padding: 16px;
      background: var(--tg-theme-bg-color, #fff);
      color: var(--tg-theme-text-color, #111);
    }
    h1 { margin: 0 0 12px; font-size: 18px; }
    .hint { opacity: .8; font-size: 13px; margin-bottom: 12px; }
    .card {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.25);
      background: rgba(127,127,127,.08);
      margin-bottom: 12px;
    }
    .k { font-weight: 600; margin-bottom: 8px; }
    pre {
      margin: 0;
      overflow: auto;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0,0,0,.10);
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>

<body>
  <h1>Telegram Mini App — Debug</h1>
  <div class="hint">
    Открой внутри Telegram. initDataUnsafe — НЕ доверять без серверной проверки подписи initData.
  </div>

  <div class="card">
    <div class="k">1) URL при открытии</div>
    <pre id="urlDump"></pre>
  </div>

  <div class="card">
    <div class="k">2) Telegram.WebApp — базовые поля (без theme/viewport)</div>
    <pre id="baseDump"></pre>
  </div>

  <div class="card">
    <div class="k">3) initData (сырой)</div>
    <pre id="initDataDump"></pre>
  </div>

  <div class="card">
    <div class="k">4) initDataUnsafe (распарсенный объект)</div>
    <pre id="unsafeDump"></pre>
  </div>

  <div class="card">
    <div class="k">5) Доступные ключи в Telegram.WebApp (для твоей версии)</div>
    <pre id="keysDump"></pre>
  </div>

  <script>
    function safeJson(obj) {
      try { return JSON.stringify(obj, null, 2); }
      catch { return String(obj); }
    }

    function dumpAll() {
      const urlInfo = {
        href: location.href,
        origin: location.origin,
        pathname: location.pathname,
        search: location.search,
        hash: location.hash,
        query: Object.fromEntries(new URLSearchParams(location.search).entries()),
      };
      document.getElementById('urlDump').textContent = safeJson(urlInfo);

      const tg = window.Telegram?.WebApp;
      if (!tg) {
        document.getElementById('baseDump').textContent =
          'Telegram.WebApp недоступен. Открой страницу внутри Telegram Mini App.';
        document.getElementById('initDataDump').textContent = '';
        document.getElementById('unsafeDump').textContent = '';
        document.getElementById('keysDump').textContent = '';
        return;
      }

      const base = {
        version: tg.version,
        platform: tg.platform,
        colorScheme: tg.colorScheme,

        isExpanded: tg.isExpanded,
        isClosingConfirmationEnabled: tg.isClosingConfirmationEnabled,

        headerColor: tg.headerColor,
        backgroundColor: tg.backgroundColor,

        initDataPresent: Boolean(tg.initData),
        initDataLength: tg.initData?.length ?? 0,
      };
      document.getElementById('baseDump').textContent = safeJson(base);

      document.getElementById('initDataDump').textContent = tg.initData || '(empty)';

      document.getElementById('unsafeDump').textContent = safeJson(tg.initDataUnsafe);

      const keys = Object.keys(tg).sort();
      document.getElementById('keysDump').textContent = safeJson(keys);
    }

    // init
    (function () {
      const tg = window.Telegram?.WebApp;
      if (tg) tg.ready(); // просто сообщаем Telegram "готово"
      dumpAll();
    })();
  </script>
</body>
</html>
